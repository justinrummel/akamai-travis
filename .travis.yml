sudo: false
language: python
python:
  - "2.7"
  - "3.4"
virtualenv:
  system_site_packages: true

addons:
  apt:
    packages:
      - dnsutils    # for dig command in /script/cibuild
      - golang-go   # for akamai cli packages
      - dep         # for go compile of akamai-purge

before_install:
  - openssl aes-256-cbc -K $encrypted_47d2d923bf7d_key -iv $encrypted_47d2d923bf7d_iv -in edgerc.txt.enc -out .edgerc -d

before_script:
  - chmod +x ./script/cibuild

script: ./script/cibuild

before_deploy:
  - curl -L https://github.com/akamai/cli/releases/download/1.0.2/akamai-1.0.2-linuxamd64 -o akamai
  - chmod +x akamai
  - export PATH=$PATH:$PWD
  - echo "Y" | akamai -version
  - sleep 5
#  - echo "Y" | akamai install purge
#  - sleep 5
  - go get github.com/akamai/cli-purge
  - cd $GOPATH/src/github.com/akamai/cli-purge
  - dep ensure
  - go build -o akamai-purge
  - export PATH=$PATH:$PWD

deploy:
  - provider: script
    skip_cleanup: true
    script: echo "Hello"
    on:
      branch: master

after_deploy:
  - |
    akamai purge --edgerc .edgerc --section travis delete --cpcode 490267
